<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Ultra Neon AR Cam</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}
body{
background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);
height:100vh;
overflow:hidden;
display:flex;
flex-direction:column;
color:white;
}

header{
text-align:center;
padding:8px;
font-weight:800;
font-size:18px;
background:linear-gradient(90deg,#ff00cc,#00ffff);
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
}

#camWrap{
position:relative;
flex:1;
display:flex;
justify-content:center;
align-items:center;
overflow:hidden;
}

video,canvas{
position:absolute;
max-width:100%;
max-height:100%;
border-radius:15px;
}

.panel{
background:rgba(0,0,0,0.6);
backdrop-filter:blur(10px);
padding:8px;
display:flex;
flex-direction:column;
gap:6px;
}

.row{
display:flex;
overflow-x:auto;
gap:6px;
}

button{
padding:6px 10px;
border-radius:18px;
border:none;
background:linear-gradient(90deg,#ff512f,#dd2476);
color:white;
font-weight:600;
font-size:12px;
cursor:pointer;
white-space:nowrap;
}

.slider{
width:100%;
}

footer{
text-align:center;
font-style:italic;
font-size:12px;
padding:4px;
opacity:0.7;
}
</style>
</head>

<body>

<header>Ultra Neon AR Cam</header>

<div id="camWrap">
<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>
</div>

<div class="panel">

<div class="row" id="effectsRow"></div>

<input type="range" min="0" max="1" step="0.01" value="0.3" id="beauty" class="slider">

<div class="row">
<button onclick="switchCam()">Switch</button>
<button onclick="capture()">Capture</button>
<button onclick="share()">Share</button>
<button onclick="resetEffect()">Reset</button>
</div>

</div>

<footer>Created by Animesh</footer>

<script>

const video=document.getElementById("video");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

let facing="user";
let stream=null;
let currentEffect=null;
let beautyLevel=0.3;
let faces=[];
let segmentationMask=null;

const effects=[
["Big Eyes","bigEyes"],
["Wide Smile","smile"],
["Alien","alien"],
["Chipmunk","puff"],
["Tiny Face","tiny"],
["Balloon Head","balloon"],
["Jaw Pro","jaw"],
["Dark Alpha","dark"],
["Neon Glow","neon"],
["Golden Rich","gold"],
["Mirror Warp","mirror"],
["Shock","shock"],
["Meme","meme"],
["Pixar","pixar"],
["Old Age","old"],
["Baby Mode","baby"],
["Angry","angry"],
["Luxury","lux"],
["Glitch","glitch"],
["Stretch","stretch"],
["Wide Face","wide"],
["Narrow Face","narrow"],
["Zoom","zoom"],
["Swirl","swirl"],
["Flip","flip"]
];

const effectsRow=document.getElementById("effectsRow");
effects.forEach(e=>{
const b=document.createElement("button");
b.innerText=e[0];
b.onclick=()=>currentEffect=e[1];
effectsRow.appendChild(b);
});

document.getElementById("beauty").oninput=(e)=>beautyLevel=parseFloat(e.target.value);

async function startCam(){
if(stream) stream.getTracks().forEach(t=>t.stop());
stream=await navigator.mediaDevices.getUserMedia({
video:{facingMode:facing,width:{ideal:960},height:{ideal:540}}
});
video.srcObject=stream;
}

function switchCam(){
facing=(facing==="user")?"environment":"user";
startCam();
}

function resetEffect(){currentEffect=null;}

function capture(){
const link=document.createElement("a");
link.download="ultra_ar.png";
link.href=canvas.toDataURL("image/png");
link.click();
}

async function share(){
if(navigator.share){
const blob=await new Promise(r=>canvas.toBlob(r,"image/png"));
const file=new File([blob],"ultra_ar.png",{type:"image/png"});
navigator.share({files:[file],title:"Ultra Neon AR Cam"});
}else{
alert("Sharing not supported. Use Capture.");
}
}

const faceMesh=new FaceMesh({
locateFile:(file)=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`
});
faceMesh.setOptions({
maxNumFaces:2,
refineLandmarks:true,
minDetectionConfidence:0.5,
minTrackingConfidence:0.5
});
faceMesh.onResults(res=>{
faces=res.multiFaceLandmarks||[];
});

const segmenter=new SelfieSegmentation({
locateFile:(file)=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`
});
segmenter.setOptions({modelSelection:1});
segmenter.onResults(res=>{
segmentationMask=res.segmentationMask;
});

async function process(){
await faceMesh.send({image:video});
await segmenter.send({image:video});
requestAnimationFrame(process);
}

video.onloadedmetadata=()=>{
canvas.width=540;
canvas.height=540*video.videoHeight/video.videoWidth;
process();
render();
};

function render(){
ctx.clearRect(0,0,canvas.width,canvas.height);

if(segmentationMask){
ctx.save();
ctx.drawImage(video,0,0,canvas.width,canvas.height);
ctx.globalCompositeOperation="destination-over";
ctx.filter="blur(10px)";
ctx.drawImage(video,0,0,canvas.width,canvas.height);
ctx.restore();
}else{
ctx.drawImage(video,0,0,canvas.width,canvas.height);
}

if(currentEffect){
ctx.save();
if(currentEffect==="bigEyes") ctx.scale(1.1,1.1);
if(currentEffect==="tiny") ctx.scale(0.8,0.8);
if(currentEffect==="balloon") ctx.scale(1.2,1.05);
if(currentEffect==="mirror") ctx.scale(-1,1);
if(currentEffect==="flip") ctx.scale(1,-1);
if(currentEffect==="zoom") ctx.scale(1.3,1.3);
if(currentEffect==="narrow") ctx.scale(0.8,1);
if(currentEffect==="wide") ctx.scale(1.2,1);
if(currentEffect==="swirl") ctx.rotate(0.05);
ctx.drawImage(canvas,0,0);
ctx.restore();
}

if(beautyLevel>0){
ctx.filter=`blur(${beautyLevel*3}px) brightness(${1+beautyLevel*0.2})`;
ctx.drawImage(canvas,0,0);
ctx.filter="none";
}

if(faces.length===2){
ctx.globalAlpha=0.5;
ctx.drawImage(canvas,10,10);
ctx.globalAlpha=1;
}

requestAnimationFrame(render);
}

startCam();

</script>

</body>
</html>
